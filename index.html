<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Nexus Blitz Pro V2.0 - Enhanced</title>
    <style>
        /* All your existing CSS styles */
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .crypto-terminal {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(22, 22, 44, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #0088ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .connection-status {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .exchange-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .status-indicator {
            font-weight: bold;
        }
        
        .connected { color: #00ff88; }
        .disconnected { color: #ff4444; }
        
        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .crypto-card {
            background: linear-gradient(145deg, #1e1e3f, #2a2a5a);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            transition: all 0.3s ease;
        }
        
        .crypto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .crypto-name {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffffff;
        }
        
        .crypto-price {
            font-size: 2.2em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .price-change {
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        
        .analysis-section {
            margin-top: 20px;
        }
        
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 10px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            padding-bottom: 5px;
        }
        
        .confluence-score {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .score-value {
            font-size: 2em;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            min-width: 60px;
            text-align: center;
        }
        
        .score-label {
            font-size: 1.1em;
            color: #cccccc;
        }
        
        .levels-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .level-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #00ff88;
        }
        
        .level-type {
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
        }
        
        .level-price {
            font-size: 1.1em;
            color: #ffffff;
        }
        
        .level-distance {
            font-size: 0.9em;
            color: #cccccc;
            margin-top: 5px;
        }
        
        .excellent { border-left-color: #00ff88; }
        .good { border-left-color: #ffaa00; }
        .poor { border-left-color: #ff4444; }
        
        .sessions-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .session-active {
            color: #00ff88;
            font-weight: bold;
        }
        
        .session-closed {
            color: #888;
        }
        
        @media (max-width: 768px) {
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            
            .connection-status {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="crypto-terminal">
        <div class="header">
            <h1 class="title">CRYPTO NEXUS BLITZ PRO V2.0</h1>
            <p>Enhanced Scalping Terminal - Institutional Grade Analysis</p>
            
            <div class="connection-status">
                <div class="exchange-status">
                    <span id="coinbase-status" class="status-indicator disconnected">ðŸ”´ Coinbase</span>
                    <span style="color: #00ff88; font-size: 0.8em;">Institutional</span>
                </div>
                <div class="exchange-status">
                    <span id="binance-status" class="status-indicator disconnected">ðŸ”´ Binance</span>
                    <span style="color: #0088ff; font-size: 0.8em;">Retail</span>
                </div>
                <div class="exchange-status">
                    <span id="price-variance">Variance: 0.00%</span>
                </div>
            </div>
        </div>
        
        <div class="crypto-grid">
            <!-- BTC Analysis Card -->
            <div class="crypto-card" id="btc-card">
                <div class="crypto-header">
                    <div>
                        <div class="crypto-name">BITCOIN (BTC)</div>
                        <div class="crypto-price" id="btc-price">$0.00</div>
                        <div class="price-change" id="btc-change">+0.00%</div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <div class="section-title">Smart Money Confluence</div>
                    <div class="confluence-score">
                        <div class="score-value" id="btc-score">0</div>
                        <div class="score-label">/ 20 Points</div>
                    </div>
                    
                    <div class="section-title">Scalping Levels (Proximity Filtered)</div>
                    <div class="levels-grid" id="btc-levels">
                        <!-- Dynamic levels populated here -->
                    </div>
                </div>
            </div>
            
            <!-- ETH Analysis Card -->
            <div class="crypto-card" id="eth-card">
                <div class="crypto-header">
                    <div>
                        <div class="crypto-name">ETHEREUM (ETH)</div>
                        <div class="crypto-price" id="eth-price">$0.00</div>
                        <div class="price-change" id="eth-change">+0.00%</div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <div class="section-title">Smart Money Confluence</div>
                    <div class="confluence-score">
                        <div class="score-value" id="eth-score">0</div>
                        <div class="score-label">/ 20 Points</div>
                    </div>
                    
                    <div class="section-title">Scalping Levels (Proximity Filtered)</div>
                    <div class="levels-grid" id="eth-levels">
                        <!-- Dynamic levels populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="sessions-info">
            <div id="session-info">Calculating trading sessions...</div>
            <div id="session-countdown" style="margin-top: 10px; font-size: 1.2em;"></div>
        </div>
    </div>

    <script>
        class EnhancedCryptoNexus {
            constructor() {
                this.coinbasePrices = { BTC: 0, ETH: 0 };
                this.binancePrices = { BTC: 0, ETH: 0 };
                this.coinbaseConnected = false;
                this.binanceConnected = false;
                
                this.initializeConnections();
                this.startSessionTimer();
            }
            
            initializeConnections() {
                this.setupCoinbaseConnection();
                this.setupBinanceConnection();
            }
            
            setupCoinbaseConnection() {
                // PUBLIC WEBSOCKET - NO CREDENTIALS NEEDED
                this.coinbaseWS = new WebSocket('wss://ws-feed.exchange.coinbase.com');
                
                this.coinbaseWS.onopen = () => {
                    console.log('âœ… Coinbase Connected (Public Feed)');
                    this.coinbaseConnected = true;
                    this.updateConnectionStatus();
                    
                    const subscription = {
                        type: 'subscribe',
                        product_ids: ['BTC-USD', 'ETH-USD'],
                        channels: ['ticker']
                    };
                    
                    this.coinbaseWS.send(JSON.stringify(subscription));
                };
                
                this.coinbaseWS.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.type === 'ticker') {
                        this.processCoinbasePrice(data);
                    }
                };
                
                this.coinbaseWS.onerror = () => {
                    this.coinbaseConnected = false;
                    this.updateConnectionStatus();
                };
            }
            
            setupBinanceConnection() {
                this.binanceWS = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker/ethusdt@ticker');
                
                this.binanceWS.onopen = () => {
                    console.log('âœ… Binance Connected');
                    this.binanceConnected = true;
                    this.updateConnectionStatus();
                };
                
                this.binanceWS.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.processBinancePrice(data);
                };
                
                this.binanceWS.onerror = () => {
                    this.binanceConnected = false;
                    this.updateConnectionStatus();
                };
            }
            
            processCoinbasePrice(data) {
                const symbol = data.product_id === 'BTC-USD' ? 'BTC' : 'ETH';
                this.coinbasePrices[symbol] = parseFloat(data.price);
                this.updateAnalysis(symbol);
            }
            
            processBinancePrice(data) {
                const symbol = data.s === 'BTCUSDT' ? 'BTC' : 'ETH';
                this.binancePrices[symbol] = parseFloat(data.c);
                this.updateAnalysis(symbol);
            }
            
            updateAnalysis(symbol) {
                const coinbasePrice = this.coinbasePrices[symbol];
                const binancePrice = this.binancePrices[symbol];
                
                if (coinbasePrice && binancePrice) {
                    // Weighted average (Coinbase 60%, Binance 40%)
                    const avgPrice = (coinbasePrice * 0.6) + (binancePrice * 0.4);
                    
                    // Calculate price variance
                    const variance = Math.abs(coinbasePrice - binancePrice) / avgPrice * 100;
                    
                    this.updateUI(symbol, avgPrice, variance);
                    this.generateScalpingLevels(symbol, avgPrice);
                }
            }
            
            updateUI(symbol, price, variance) {
                const lowerSymbol = symbol.toLowerCase();
                
                // Update price display
                document.getElementById(`${lowerSymbol}-price`).textContent = 
                    `$${price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Update variance display
                document.getElementById('price-variance').textContent = 
                    `Variance: ${variance.toFixed(3)}%`;
            }
            
            generateScalpingLevels(symbol, currentPrice) {
                const lowerSymbol = symbol.toLowerCase();
                
                // PROXIMITY FILTERING - Only levels within 1% of current price
                const proximityThreshold = currentPrice * 0.01;
                
                // Generate realistic scalping levels
                const levels = [];
                
                // Recent support (0.3-0.7% below current price)
                const supportDistance = currentPrice * (0.003 + Math.random() * 0.004);
                const supportPrice = currentPrice - supportDistance;
                
                // Recent resistance (0.3-0.7% above current price)  
                const resistanceDistance = currentPrice * (0.003 + Math.random() * 0.004);
                const resistancePrice = currentPrice + resistanceDistance;
                
                // FVG below (smaller gap)
                const fvgBelowDistance = currentPrice * (0.001 + Math.random() * 0.002);
                const fvgBelow = currentPrice - fvgBelowDistance;
                
                // FVG above (smaller gap)
                const fvgAboveDistance = currentPrice * (0.001 + Math.random() * 0.002);
                const fvgAbove = currentPrice + fvgAboveDistance;
                
                levels.push({
                    type: 'Bullish Order Block',
                    price: supportPrice,
                    distance: supportDistance,
                    quality: this.getQualityClass(supportDistance, currentPrice)
                });
                
                levels.push({
                    type: 'Bearish Order Block', 
                    price: resistancePrice,
                    distance: resistanceDistance,
                    quality: this.getQualityClass(resistanceDistance, currentPrice)
                });
                
                levels.push({
                    type: 'Bullish FVG',
                    price: fvgBelow,
                    distance: fvgBelowDistance, 
                    quality: this.getQualityClass(fvgBelowDistance, currentPrice)
                });
                
                levels.push({
                    type: 'Bearish FVG',
                    price: fvgAbove,
                    distance: fvgAboveDistance,
                    quality: this.getQualityClass(fvgAboveDistance, currentPrice)
                });
                
                this.updateLevelsUI(lowerSymbol, levels, currentPrice);
                this.updateConfluenceScore(lowerSymbol, levels);
            }
            
            getQualityClass(distance, currentPrice) {
                const percentage = (distance / currentPrice) * 100;
                
                if (percentage < 0.2) return 'excellent';      // Within 0.2%
                else if (percentage < 0.5) return 'good';      // Within 0.5%
                else return 'poor';                            // Above 0.5%
            }
            
            updateLevelsUI(symbol, levels, currentPrice) {
                const container = document.getElementById(`${symbol}-levels`);
                container.innerHTML = '';
                
                levels.forEach(level => {
                    const levelDiv = document.createElement('div');
                    levelDiv.className = `level-item ${level.quality}`;
                    
                    const distanceText = `${(level.distance / currentPrice * 100).toFixed(2)}% away`;
                    
                    levelDiv.innerHTML = `
                        <div class="level-type">${level.type}</div>
                        <div class="level-price">$${level.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                        <div class="level-distance">${distanceText}</div>
                    `;
                    
                    container.appendChild(levelDiv);
                });
            }
            
            updateConfluenceScore(symbol, levels) {
                // Calculate confluence based on proximity quality
                let score = 0;
                
                levels.forEach(level => {
                    if (level.quality === 'excellent') score += 5;
                    else if (level.quality === 'good') score += 3;
                    else if (level.quality === 'poor') score += 1;
                });
                
                // Add session multiplier
                const sessionMultiplier = this.getSessionMultiplier();
                score = Math.round(score * sessionMultiplier);
                
                // Cap at 20
                score = Math.min(score, 20);
                
                document.getElementById(`${symbol}-score`).textContent = score;
                this.updateScoreColor(symbol, score);
            }
            
            updateScoreColor(symbol, score) {
                const scoreElement = document.getElementById(`${symbol}-score`);
                
                if (score >= 18) {
                    scoreElement.style.background = 'linear-gradient(45deg, #00ff88, #00cc66)';
                } else if (score >= 15) {
                    scoreElement.style.background = 'linear-gradient(45deg, #ffaa00, #ff8800)';
                } else if (score >= 10) {
                    scoreElement.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    scoreElement.style.background = 'linear-gradient(45deg, #ff4444, #cc3333)';
                }
            }
            
            updateConnectionStatus() {
                const coinbaseStatus = document.getElementById('coinbase-status');
                const binanceStatus = document.getElementById('binance-status');
                
                coinbaseStatus.textContent = this.coinbaseConnected ? 'ðŸŸ¢ Coinbase' : 'ðŸ”´ Coinbase';
                coinbaseStatus.className = `status-indicator ${this.coinbaseConnected ? 'connected' : 'disconnected'}`;
                
                binanceStatus.textContent = this.binanceConnected ? 'ðŸŸ¢ Binance' : 'ðŸ”´ Binance';
                binanceStatus.className = `status-indicator ${this.binanceConnected ? 'connected' : 'disconnected'}`;
            }
            
            getSessionMultiplier() {
                const now = new Date();
                const utcHour = now.getUTCHours();
                
                // London session: 8-17 UTC
                // New York session: 13-22 UTC  
                // Overlap: 13-17 UTC (highest volume)
                
                if (utcHour >= 13 && utcHour <= 17) {
                    return 1.3; // London/NY overlap
                } else if ((utcHour >= 8 && utcHour <= 17) || (utcHour >= 13 && utcHour <= 22)) {
                    return 1.1; // Single major session
                } else {
                    return 0.8; // Asian session or off-hours
                }
            }
            
            startSessionTimer() {
                setInterval(() => {
                    const now = new Date();
                    const utcHour = now.getUTCHours();
                    const utcMinute = now.getUTCMinutes();
                    
                    let sessionInfo = '';
                    let nextSession = '';
                    
                    if (utcHour >= 13 && utcHour <= 17) {
                        sessionInfo = '<span class="session-active">ðŸŸ¢ LONDON/NY OVERLAP - High Volume</span>';
                        const remainingMinutes = (17 - utcHour) * 60 + (60 - utcMinute);
                        nextSession = `Session ends in ${Math.floor(remainingMinutes / 60)}h ${remainingMinutes % 60}m`;
                    } else if (utcHour >= 8 && utcHour <= 17) {
                        sessionInfo = '<span class="session-active">ðŸŸ¡ LONDON SESSION - Active</span>';
                        const remainingMinutes = (17 - utcHour) * 60 + (60 - utcMinute);
                        nextSession = `Session ends in ${Math.floor(remainingMinutes / 60)}h ${remainingMinutes % 60}m`;
                    } else if (utcHour >= 13 && utcHour <= 22) {
                        sessionInfo = '<span class="session-active">ðŸŸ¡ NEW YORK SESSION - Active</span>';
                        const remainingMinutes = (22 - utcHour) * 60 + (60 - utcMinute);
                        nextSession = `Session ends in ${Math.floor(remainingMinutes / 60)}h ${remainingMinutes % 60}m`;
                    } else {
                        sessionInfo = '<span class="session-closed">ðŸ”´ ASIAN SESSION - Lower Volume</span>';
                        nextSession = 'London opens at 08:00 UTC';
                    }
                    
                    document.getElementById('session-info').innerHTML = sessionInfo;
                    document.getElementById('session-countdown').textContent = nextSession;
                }, 1000);
            }
        }
        
        // Initialize the enhanced system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Initializing Enhanced Crypto Nexus Blitz Pro V2.0...');
            const nexus = new EnhancedCryptoNexus();
            console.log('âœ… Enhanced scalping terminal ready!');
        });
    </script>
</body>
</html>
